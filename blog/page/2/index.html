
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Alex Belozerov Blog</title>
  <meta name="author" content="Alex Belozerov">

  
  <meta name="description" content="Данный пост является переводом статьи The UpdatePanel opened: what happens behind the scenes? с сайта dotnetslackers.com.UpdatePanel - одна из самых &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://abelozerov.com/blog/page/2/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/abelozerov" rel="alternate" title="Alex Belozerov Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-34351042-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Alex Belozerov Blog</a></h1>
  
    <h2>Interesting Inside.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/abelozerov" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:abelozerov.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="http://www.welldonecode.com/perfectpixel.html" target="_blank">PerfectPixel</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/04/01/updatepanel/">UpdatePanel: что происходит за кулисами?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-04-01T23:57:00+07:00" pubdate data-updated="true">Apr 1<span>st</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
Данный пост является переводом статьи <a href="http://dotnetslackers.com/articles/ajax/The_UpdatePanel_opened_what_happens_behind_the_scenes.aspx">The UpdatePanel opened: what happens behind the scenes?</a> с сайта dotnetslackers.com.<br /><br />UpdatePanel - одна из самых главных и интересных фич ASP.NET AJAX. Она волшебным способом позволяет добавить на сайт прелести AJAX, при этом не требуя практически никаких дополнительных усилий от вас как от разработчика. Вы почувствуете лишь толику неудобства, перетащив UpdatePanel на вашу веб форму, и позволив ей делать всю работу. Как же она работает?<br /><br /><b>Введение</b><br /><br />В статье я шаг за шагом проведу вас через то, что происходит в браузере во время обновления UpdatePanel. Вы увидите какие events запускаются, в каких точках можно перехватывать обработку, и в общем почувствуете последовательность событий.<br /><br />Возьмем простейший пример. Я создал <b>UpdatePanel</b> с двумя контролами внутри: <b>Button</b> и <b>Label</b>.<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="http://1.bp.blogspot.com/_Y-VHRlKoRnE/Sz8GaxX8qGI/AAAAAAAAAUE/MwHugyQxxK4/s1600-h/picture01.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/_Y-VHRlKoRnE/Sz8GaxX8qGI/AAAAAAAAAUE/MwHugyQxxK4/s320/picture01.png" /></a></div><br />Пусть при нажатии на кнопку в label записывается текущее время:<br /><br /><pre class="c-sharp" name="code">using System;<br />public partial class _Default : System.Web.UI.Page <br />{<br />    protected void Button1_Click(object sender, EventArgs e)<br />    {<br />        Label1.Text = DateTime.Now.ToString();<br />    }<br />}<br /></pre><br />Существует 3 основных события, происходящих в браузере, и все три затрагивают объект PageRequestManager, центральный объект в архитектуре ASP.NET AJAX. Первое событие запускается потому что мы нажали кнопку. Второе - потому что происходит submit формы. Последнее событие запускается после того как получен ответ с сервера.<br /><br />Перед запуском событий PageRequestManger&#8217;а, происходит множество более низкоуровневых внутренних событий, которые запускают PageRequestManager. Эти &nbsp;низкоуровневые обработчики выполняют такие функции как оборачивание браузерного event object в Sys.UI.DomEvent. Но не будем вдаваться в детали в этом месте.<br /><br /><b>Обработчик&nbsp;<span class="Apple-style-span" style="font-weight: normal;"><b>PageRequestManager&nbsp;<span class="Apple-style-span" style="font-weight: normal;"><b>_onFormElementClick</b></span></b></span></b><br /><br />Этот обработчик вызывается когда вы нажимаете кнопку внутри <b>UpdatePanel</b>, и делает следующие вещи:<br /><br />Во-первых, устанавливает свойство _postBackSettings PageRequestManager&#8217;а:<br /><br /><pre class="js" name="code">this._postBackSettings = this._getPostBackSettings(element, element.name);<br /></pre><br /><b>postBackSettings</b> содержит 3 элемента:<br /><ul><li>Булевую переменную обозначающую должен ли запрос быть асинхронным</li><li>ID UpdatePanel&#8217;и и элемента, вызвавшего postback</li><li>Ссылку на элемент вызвавшего postback</li></ul><br />Метод _getPostBackSettings проходит по дереву контролов вверх начиная с элемента, вызвавшего событие (в данном случае button) в поисках UpdatePanel. Если он найдет UpdatePanel, что в нашем случае обязательно произойдет, то установит свойство postBackSettings таким образом, чтобы произошел асинхронный запрос:<br /><br /><pre class="js" name="code">var indexOfPanel = Array.indexOf(this._updatePanelClientIDs, element.id);<br />if (indexOfPanel !== -1) <br />{<br />  if (this._updatePanelHasChildrenAsTriggers[indexOfPanel]) <br />  {<br />    return this._createPostBackSettings(true, <br />           this._updatePanelIDs[indexOfPanel] + '|' + <br />           elementUniqueID, originalElement);<br />  }<br /></pre><br />Вторая вещь, которую делает обработчик onFormElementClick - записывает в свойство additionalInput имя (name) и значение (value) нажатой кнопки. Данная процедура выполняется потому, что процесс, который собирает данные с формы когда форма готовится к submit&#8217;у, игнорирует кнопки, а value нажатой кнопки должно быть отправлено на сервер.<br /><br /><pre class="js" name="code">else if ((element.tagName === 'BUTTON') &amp;&amp; <br />        (element.name.length !== 0) &amp;&amp; <br />        (element.type === 'submit')) <br />     {<br />          this._additionalInput = element.name + '=' + <br />          encodeURIComponent(element.value);<br />     }<br /></pre><br /><b>Обработчик&nbsp;<span class="Apple-style-span" style="font-weight: normal;"><b>PageRequestManager&nbsp;<span class="Apple-style-span" style="font-weight: normal;"><b>_onFormSubmit</b></span></b></span></b><br /><br />Этот метод вызывается после того как обработчик <b>_onFormElementClick </b>заканчивает свою работу, и выполняет упаковку данных формы и отправку асинхронного запроса на сервер. Но он делает это только если требуется асинхронный запрос, что определяется значением соответствующего булевого флага в свойстве <b>_postBackSettings</b>, которое было установлено в методе <b>onFormElementClick</b>.<br /><br />В нашем случае требуется асинхронный запрос. Метод проходит по детям формы, упаковывая их значения в переменную <b>formBody</b> типа <b>StringBuilder</b>, если они являются элементами типа INPUT (text, password, hidden, checkbox and radio types), SELECT или TEXTAREA.<br /><br />Отходя от темы, небольшая оптимизация может быть выполнена для обработки <b>SELECT&#8217;ов</b>, текущая реализация просматривает каждый элемент <b>OPTION</b> для определения выбран он или нет, тогда как если свойство <b>multiple</b> <b>SELECT&#8217;а</b> равно false, можно использовать свойство selectedIndex. Если у вас 1000 опций, необязательно просматривать все 1000 если <b>SELECT</b> не <b>multiple</b>:<br /><br /><pre class="js" name="code">else if (tagName === 'SELECT') <br />{<br />  var optionCount = element.options.length;<br />  for (var j = 0; j &lt; optionCount; j++) <br />  {<br />    var option = element.options[j];<br />    if (option.selected) <br />    {<br />      formBody.append(name);<br />      formBody.append('=');<br />      formBody.append(encodeURIComponent(option.value));<br />      formBody.append('&amp;');<br />    }<br />  }<br />}<br /></pre><br />Обратите внимания что значения скрытых полей также отправляются, что означает что содержимое скрытого элемента __VIEWSTATE отправляется на сервер каждый раз. То что вы используете <b>UpdatePanel</b> не означает что вы не передаете viewstate на сервер и обратно во время асинхронного апдейта.<br /><br />Далее для того чтобы отправить запрос метод создает объект&nbsp;<b>Sys.Net.WebRequest</b> и устанавливает в его поле URL значение form action URL, устанавливает значение заголовка&nbsp;<b>x-microsoft-ajax</b> в <b>delta=true</b>, что сигнализирует о том что это запрос для получения дельт/delta (изменений) документа. Также он отключает кэширование и устанавливает timeout в значение,&nbsp;определенное&nbsp;в ScriptManager серверной части.<br /><br /><pre class="js" name="code">var request = new Sys.Net.WebRequest();<br />request.set_url(form.action);<br />request.get_headers()['X-MicrosoftAjax'] = 'Delta=true';<br />request.get_headers()['Cache-Control'] = 'no-cache';<br />request.set_timeout(this._asyncPostBackTimeout);<br /></pre><br />Очевидно что&nbsp;<b>PageRequestManager </b>должен быть оповещен о пришествии ответа с сервера, и это осуществляется за счет создания делегата на его метод&nbsp;<b>_onFormSubmitCompleted </b>и добавления этого <b>делегата </b>к списку делегатов которые вызываются после завершения запроса:<br /><br /><pre class="js" name="code">request.add_completed(<br />    Function.createDelegate(this, <br />             this._onFormSubmitCompleted));<br /></pre><br />Можно подумать, что&nbsp;<b>PageRequestManager&nbsp;&nbsp;</b>уже готов отправить запрос, однако есть еще несколько вещей, которые он должен сделать.<br /><br />Одна из фич, которые мне нравятся больше всего в дизайне ASP.NET и ASP.NET AJAX - это то, что существует множество точек, где разработчик может перехватить выполнение стандартной обработки и добавить свою функциональность. И это здорово, потому что позволяет нам добавлять фичи о которых Microsoft не могла даже мечтать, и лично для меня показывает открытость, которую Microsoft не демонстрировала долгие годы.<br /><br />Итак, перед тем как запрос будет отправлен,&nbsp;<b>PageRequestManager &nbsp;</b>запускает событие&nbsp;<b>InitializeRequest</b>, для каждого, кто подписан на него, на этой стадии отправка формы может быть отменена подписчиками на событие путем установки флага cancel аргумента события:<br /><br /><pre class="js" name="code">var handler = this._get_eventHandlerList().getHandler("initializeRequest");<br />if (handler) {<br />    var eventArgs = new Sys.WebForms.InitializeRequestEventArgs(<br />       request, this._postBackSettings.sourceElement);<br />    handler(this, eventArgs);<br />    continueSubmit = !eventArgs.get_cancel();<br />}<br /></pre><br />Пример того, как код пользователя может подписаться на это событие:<br /><br /><pre class="js" name="code">var prm = Sys.WebForms.PageRequestManager.getInstance();<br />prm.add_initializeRequest(InitializeRequestHandler);<br /><br />function InitializeRequestHandler(sender, initializeRequestEventArgs) {<br />    var cancel = !confirm('Initialize request occurring.');<br />    initializeRequestEventArgs.set_cancel(cancel);<br />}<br /></pre><br />После того, как прошло событие&nbsp;<b>InitializeRequest,&nbsp;</b>и если отправка не была отменена,&nbsp;<b>PageRequestManager &nbsp;</b>запускает событие&nbsp;<b>BeginRequest </b>для каждого, кто на него подписан. Разница в том, что на этой стадии отправка уже не может быть отменена.<br /><br />В конце, записав текущую scroll position документа в свойство&nbsp;<b>_scrollPosition</b>, он просит&nbsp;<b>Sys.Net.WebRequest</b> отправить запрос, и отменяет обработку события кнопки по умолчанию, чтобы ничего более не произошло до того как вернется&nbsp;<b>WebRequest</b>:<br /><br /><pre class="js" name="code">request.invoke();<br /><br />if (evt) {<br />    evt.preventDefault();<br />}<br /></pre><br /><b>Обработчик&nbsp;<span class="Apple-style-span" style="font-weight: normal;"><b>PageRequestManager&nbsp;<span class="Apple-style-span" style="font-weight: normal;"><b>_onFormSubmitCompleted</b></span></b></span></b><br /><br />Этот метод вызывается после того как получен ответ с сервера, либо что-то пошло не так<br /><br />Первая вещь которую он делает - проверяет всё, что могло пойти не так, такие вещи как таймаут, был ли запрос прерван, или пришел ответ на какой-то другой (левый) запрос, произошла какая-то ошибка и т.д., ну вы поняли. В большинстве случаев он вызывает внутренний метод&nbsp;<b>_endPostBack</b>, который запускает событие <b>EndRequest&nbsp;</b>для каждого кто на него подписан.<br /><br />После того как выполнены проверки, метод пробегает по response buffer, полученному с сервера, извлекая <b>delta nodes</b>, каждая из которых содержит <b>type</b>, <b>id</b> и <b>content<span class="Apple-style-span" style="font-weight: normal;">.</span></b><br /><br />После получения массива <b>deltas</b>, метод пробегает по каждому из них. Существует около 20 различных типов delta nodes, некоторые из которых обрабатываются немедленно, например document title:<br /><br /><pre class="js" name="code">for (var i = 0; i &lt; delta.length; i++) {<br />    var deltaNode = delta[i];<br />    switch (deltaNode.type) {<br />        ...<br />        case "pageTitle":<br />            document.title = deltaNode.content;<br />            break;<br /></pre><br />Остальные сохраняются для дальнейшей обработки:  <br /><br /><pre class="js" name="code">case "updatePanel":<br />            Array.add(updatePanelNodes, deltaNode);<br />            break;<br />        case "hiddenField":<br />            Array.add(hiddenFieldNodes, deltaNode);<br />            break;<br /></pre><br />После группировки <b>delta nodes</b> по соответствующим типам, происходит обработка каждого типа&nbsp;<b>delta node</b>, но не перел тем как запустится событие <b>PageLoadingEvent </b>для каждого кто на него подписан.<br /><br />Обработка <b>updatePanelNodes</b> заключается в уничтожении существующего содержимого панели и заменой его содерджимым поля content delta node.<br /><br />В конце все скрипты которые должны&nbsp;загрузиться, загружаются, и в методе <b>_scriptsLoadComplete</b> запускаются события <b>PageLoadedEvent</b> и <b>EndRequestEvents</b>, окно документа прокручивается до соответствующей позиции, фокус устанавливается на соответствующий <b>контрол</b>, и на этом история завершается.<br /><br />Вы можете быть склонны думать, что всё это предельно просто и понятно, и для представленного элементарного случая это действительно так. Но если вы задумаетесь о сложности того, что можно сделать на сервере, тогда вы поймете что тут еще много всего. К примеру что если вы зарегистрируете новые script blocks на сервере, или установите фокус на другой контрол? Именно поэтому существует около 20 типов <b>delta node</b>, каждый для обработки своего специфического сценария.<br /><br /><b>Заключение</b><br /><br />В этой статье мы шаг за шагом разобрали что же происходит в браузере во время обновления UpdatePanel, никакой магии конечно, просто довольно много кода обрабатывающего специфические ситуации, и куча мест, где программист может перехватить стандартную обработку и добавить немного своей магии<br /><br /><b>Что дала мне эта статья (от переводчика):</b><br /><br />Теперь понятно почему перед отправкой асинхронного запроса на сервер невозможно понять какие именно UpdatePanelи будут обновляться, клиент такую информацию вообще не передает, сервер по желанию может в response прислать обновление для каждой UpdatePanel на странице. С одной стороны, удобно, с другой, не получится красиво реализовать Progress bar, закрывающий одну единственную панель при ее обновлении.<br /><br /><b>P.S.</b> Отправил статью на хабр в <a href="http://habrahabr.ru/sandbox/12113/">песочницу</a>. Буду рад получить приглашение, если статья вам понравилась и вы считаете что я его заслужил.</div>
<h2>Archived comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'><em>Даша Шулеко</em></div>
<div class='content'>
Спасибо большое! Очень пригодилось.</div>
</div>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/12/19/stringformat/">Фигурные скобки внутри String.Format()</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-19T15:52:00+06:00" pubdate data-updated="true">Dec 19<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
Метод String.Format() позволяет вставлять значения переменных внутрь строки в места, помеченные с помощью фигурных скобок и индекса, например:<br /><br /><pre class="c-sharp" name="code">string.Format("My name is {0}", name);</pre><br />Но если в строке есть фигурные скобки, не относящиеся к местам подстановки переменных, вы получите Exception при компиляции, т.к. компилятор думает что всё что стоит между открывающей и закрывающей скобками является индексом.<br /><br /><pre class="c-sharp" name="code">string.Format("{name}={0}", name); // Exception</pre><br />Существует простое решение, как вставить в строку фигурную скобку: нужно написать ее 2 раза: <br /><br /><pre class="c-sharp" name="code">string name = "Alex";<br />string formattedStr = string.Format("={0}", name); // no exception<br /></pre><br />В итоге в примере formattedStr будет равно &#8220;{name}=Alex&#8221;</div>
<h2>Archived comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'><em>alex</em></div>
<div class='content'>
Спасибо! Да, пожалуйста, с указанием источника</div>
</div>
<div class='comment'>
<div class='author'><em>Anonymous</em></div>
<div class='content'>
Очень интересная статья. Скажите, а могу ли я ее повесить на один из своих сайтов? Соотвественно с гиперсылкой на вас.</div>
</div>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/10/20/iphone/">Купил iPhone</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-20T01:43:00+07:00" pubdate data-updated="true">Oct 20<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
Купил Apple iPhone 3G на замену неожиданно скончавшемуся SonyEricsson T630.<br /><div>Первые впечатления - от телефона в полном восторге :-) но это именно что телефон, не стоит ждать от него возможностей полноценного коммуникатора&#8230;<br /><div><br /></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://images.apple.com/iphone/compare-iphones/images/iphone-3g-20090608.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="http://images.apple.com/iphone/compare-iphones/images/iphone-3g-20090608.jpg" width="152" /></a><br /></div><div><br /></div><div><b>Что особенно понравилось (привело в восторг):</b><br /></div><div><ul><li>Роскошный, притягательный внешний вид. Выглядит дорого и стильно, аналогия из мира бытовой техники - PlayStation 3, тот же роскошный черный глянец. Продуманность размеров и формы корпуса - в руке лежит как влитой. Идеальные размер и разрешение экрана.</li><li>Емкостной тачскрин отлично реагирует на малейшие прикосновения пальцев и совершенно не реагирует на прикосновения посторонних предметов. Лучший тачскрин из всех опробованных мной телефонов!</li><li>Удобство, красота (какая анимация!) и продуманность оболочки телефона и стандартных приложений: iPod, Mail, Safari, календарь, фотографии, погода, акции, заметки и др.</li><li>Safari в iPhone - единственный мобильный браузер, которым можно пользоваться. Выглядят сайты точно так же как на &#8220;большом&#8221; Safari, ничего не слетает и не уползает, в полной мере поддерживается CSS и JavaScript. Отличное управление посредством Multi-touch!</li><li>Работа с Wi-Fi. Телефон автоматически коннектится к известной Wi-Fi сети, если находится в радиусе ее действия. При переходе в режим ожидания происходит отключение от беспроводной сети, телефон экономит батарею :-) При &#8220;оживлении&#8221; опять коннектится.&nbsp;</li><li>Наушники и качество звука. iPhone выдает очень даже качественный звук, имеет хороший выход на наушники - достаточная громкость, нет завала на низких или высоких частотах (чем грешил мой Creative ZEN), приличная детализация и динамика. Просто поразили комплектные наушники - как по внешнему виду, так и по качеству звучания. Средние и высокие частоты воспроизводят, не побоюсь провести такое сравнение, не хуже моих домашних Sennheiser HD595! Низких частот мало (кто-то скажет что вообще нет), зато качественные.</li><li>Управление посредством гарнитуры. На комплектных наушниках имеется кнопка с вмонтированным микрофоном. Кнопка отвечает за прием (однократное нажатие) и отклонение (двойное нажатие) звонков, а также управляет плеером - можно поставить воспроизведение на паузу (однократное нажатие), перейти на следующий трек&nbsp;(двойное нажатие) или на предыдущий трек (тройное нажатие). ИМХО очень удобно, в 90% ситуаций телефон из кармана доставать не нужно.</li><li>Большой выбор программ в AppStore - от игр до специализированных медицинских приложений. Тут есть мой любимый Peggle!</li></ul><ol></ol><div><b>Чем несколько разочарован:</b><br /></div><div><ul><li>Закачка музыки через iTunes. Кто не знает, записать в iPhone музыку, и вообще любые данные можно лишь с помощью приложения iTunes, и вот запись музыки в нем организована очень неудобно. Я могу в лучшем случае пометить исполнителей, чьи песни я хотел бы видеть в памяти телефона. Т.е. я не могу записать 1 конкретный альбом какого-то исполнителя, только все альбомы сразу. Ну что за бред!<br /><br /><b>Update: </b>всё-таки можно, с помощью плейлистов, но это тоже извращение<br /><br /></li><li>Отсутствие мультизадачности для сторонних приложений. Данная особенность имеет как минусы, так и плюсы, однако для некоторых классов приложений мультизадачность всё же необходима, например для IM мессенджеров. Отчасти спасает поддержка Push notifications, но это всё же далеко не то же самое, что приложение, работающее в фоновом режиме. Стандартные приложения, в частности плеер, слава богу, могут работать в фоне.</li></ul><ol></ol><div><b>После 3х дней использования я сделал для себя следующие выводы:</b><br /></div><div>Замечательный телефон, которым удобно и приятно пользоваться. По совместительству отличный iPod и портативная игровая платформа.<br /></div><div>Как коммуникатор не очень хорош ввиду отсутствия мультизадачности.<br /></div><div><br /></div><div><b>Аппарат мне очень понравился, буду пользоваться с удовольствием!</b><br /></div><div><br /></div><div>А вы как относитесь к iPhone? Будет ли ваш следующий телефон телефоном от Apple?<br /></div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://images.apple.com/iphone/iphone-3g/images/intro-iphone-everything-20090909.jpg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="166" src="http://images.apple.com/iphone/iphone-3g/images/intro-iphone-everything-20090909.jpg" width="400" /></a><br /></div><div><br /></div></div></div></div></div>
<h2>Archived comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'><em>Anonymous</em></div>
<div class='content'>
спасибо большое было очень интересно читать</div>
</div>
<div class='comment'>
<div class='author'><em>Anonymous</em></div>
<div class='content'>
Хорошо! Все бы так писали :)</div>
</div>
<div class='comment'>
<div class='author'><em>Anonymous</em></div>
<div class='content'>
Мне у него больше всего нравится погоду смотреть. =) там такие картиночки красивые. Ну и вайфайка тоже удобна, когда надо что-то быстро загуглить. Но я себе вряд ли куплю такой когда-нибудь. Люблю простые телефоны, чтобы не было ничего лишнего, чтобы маленький, ударопрочный и хорошенький, в руку удобно ложился.  /Маришка</div>
</div>
<div class='comment'>
<div class='author'><em>Anonymous</em></div>
<div class='content'>
Хороший сайт. Так держать!!!</div>
</div>
<div class='comment'>
<div class='author'><em>alex</em></div>
<div class='content'>
Очень рад что вам понравилось :-) Народ, есть желание чтобы я еще какие-нибудь гаджеты описал?</div>
</div>
<div class='comment'>
<div class='author'><em>Anonymous</em></div>
<div class='content'>
А мне пост понрвился. Добавил в букмарки. (не спам)</div>
</div>
<div class='comment'>
<div class='author'><em>Anonymous</em></div>
<div class='content'>
Привет! С удовольствием почитал Ваш блог. Хочу также поздравить Вас и всех читателей этого блога с новым 2010 годом. Удачи всем, новых жизненных побед и исполнения всех ваших замыслов. :)</div>
</div>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/09/26/aspnet-redirect-querystring/">ASP.NET: Redirect с параметром без QueryString</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-09-26T17:38:00+07:00" pubdate data-updated="true">Sep 26<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
Столкнулся с ситуацией, когда необходимо сделать Redirect на другую страницу, передав при этом параметр, но так, чтобы не видел пользователь. То есть простая передача через QueryString - Response.Redirect(&#8220;~/NewPage.aspx?id=5&#8221;) - не подходит.<br /><div><br /></div><div>Я придумал решение, используя QueryString и Session:<br /></div><div><br /></div><div><b>Пример:</b> <br /></div><div>надо передать параметр id на страницу NewPage.aspx<br /></div><div><br /></div><div>Сам редирект делаем как обычно, параметр передаем через QueryString.<br /></div><pre class="c-sharp" name="code">Response.Redirect("~/NewPage.aspx?id=5")<br /></pre><div><br /></div><div>Но принимающая страница по-особому обрабатывает запрос:<br /></div><pre class="c-sharp" name="code">public partial class NewPage : System.Web.UI.Page<br />{<br />    protected void Page_Init(object sender, EventArgs e)<br />    {<br />        if (Session["NewPage_id"] != null)<br />        {<br />            // Второй запрос приходит сюда<br />            int id = Int32.Parse(Session["NewPage_id"].ToString());<br />            // Используем id<br />            // ...<br /><br />            // Освобождаем память<br />            Session["NewPage_id"] = null;<br />        }<br />        else if (Request["id"] != null)<br />        {<br />            // Первый запрос приходит сюда<br />            Session["NewPage_id"] = Request["id"];<br />            // Редирект без QueryString<br />            Response.Redirect(GetUriWithoutQueryStr(Request.Url), true);<br />        }<br />    }<br /><br />    public string GetUriWithoutQueryStr(Uri url)<br />    {<br />        return url.GetLeftPart(UriPartial.Path);<br />    }<br />}<br /></pre><div>Мы сохраняем пришедший параметр в сессию, и редиректимся на эту же страницу без QueryString. При второй загрузке параметры спокойно извлекаются из сессии и используются. Пользователь, естественно, в строке запроса никаких параметров не видит.<br /></div><div>После извлечения параметра лучше сразу удалить его из сессии, чтобы он не повлиял на последующие запросы.<br /></div><div><br />А как вы решали подобную задачу? :-)<br /></div></div>
<h2>Archived comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'><em>alex</em></div>
<div class='content'>
Вы правы, в рамках одного веб-приложения хранение в Session и Server.Transfer покрывают все возможные ситуации<br /><br />Однако представьте, что нужно отправить форму удаленному серверу, и ответом должен быть редирект на другую страницу с необходимыми параметрами. И мы хотим, чтобы ползователь параметров не увидел. Вот тут-то и пригодится способ, описанный в этой статье.</div>
</div>
<div class='comment'>
<div class='author'><em>Руслан</em></div>
<div class='content'>
А еще лучше Server.Transfer() использовать - так меньше ресурсов жрем. Но опять же в рамках одного приложения</div>
</div>
<div class='comment'>
<div class='author'><em>Roman2311</em></div>
<div class='content'>
Понятно.<br /><br />Ну может тогда через твиттер передавать параметры :)</div>
</div>
<div class='comment'>
<div class='author'><em>alex</em></div>
<div class='content'>
Важное замечание, Роман!<br /><br />Действительно, нет смысла так извращаться, если редирект происходит на страницу, находящуюся в том же web-приложении (т.е. обе страницы имеют доступ одной и той же Session).<br /><br />Мой способ может пригодиться, если редирект приходит с другого сервера</div>
</div>
<div class='comment'>
<div class='author'><em>Roman2311</em></div>
<div class='content'>
Может я что-то не так понял, но почему бы просто не сделать:<br /><br /><i><br />Session[&quot;NewPage_id&quot;] = 5;<br />Response.Redirect(&quot;~/NewPage.aspx&quot;);<br /></i><br /><br />Я нутром чувствую, что все на так просто&#8230; но все же</div>
</div>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/05/30/blog-post/">Привет</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-05-30T16:45:00+07:00" pubdate data-updated="true">May 30<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
<strong>Всем привет!</strong> <br />Меня зовут Алексей, я программист-фрилансер из г. Омска.<br />В этот блог я буду писать свои мысли и наблюдения относительно жизни омских ИТшников, сообщать об интересных событиях, да просто писать о том что меня волнует и что мне интересно. Будет и программирование.&nbsp;В первую очередь блог адресован людям, варящимся в ИТ-кухне, моим друзьям, но постараюсь чтобы он был интересен и понятен более широкой аудитории ;-)</div>
<h2>Archived comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'><em>alex</em></div>
<div class='content'>
Спасибо за советы, Рома!</div>
</div>
<div class='comment'>
<div class='author'><em>Roman2311</em></div>
<div class='content'>
Да, еще зарегайся на фидбернере и подруби его. Штука полезная. <br /><br />Еще я очень люблю, когда показывается, сколько комментариев к каждому посту. Прочитал пост в гугл ридере, если есть комментарии, то можно сразу и их почитать и описаться (IMHO)</div>
</div>
<div class='comment'>
<div class='author'><em>Roman2311</em></div>
<div class='content'>
Привет, поздравляю тебя с открытием блога. Желаю хороших постов и постоянных читателей.<br /><br />Одно важное пожелание, если хочешь, чтобы писали больше комментов, то выруби нафиг капчу и сделай возможность писать анонимным пользователям. Спама на блогспоте почему-то нету.</div>
</div>
</div>
</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/09/08/rieshieniie-probliemy-s-google-i-dom-dot-ru/">Решение проблемы с Google и Дом.Ру</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/26/kak-ia-pieriekhodil-s-blogger-na-octopress/">Как я переходил с Blogger на Octopress</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/26/octopress-hello-world/">Octopress hello world!</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/10/21/gdd-2011-gtugs-day-2011/">GDD 2011 и GTUGs Day 2011</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/08/15/google-developer-day-challenge-2011/">Google Developer Day Challenge 2011</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("abelozerov", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/abelozerov" class="twitter-follow-button" data-show-count="false">Follow @abelozerov</a>
  
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Alex Belozerov -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'abelozerov';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
